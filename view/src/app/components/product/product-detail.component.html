<app-header></app-header>

<div *ngIf="loading" class="d-flex justify-content-center align-items-center" style="min-height: 50vh;">
  <div class="spinner-border text-danger" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<div *ngIf="!loading && product" class="main-wrapper py-4" style="background-color: #f4f6f8; min-height: 100vh;">
  <div class="container">

    <div class="mb-3">
      <button class="btn btn-link text-decoration-none text-muted p-0 fw-bold" (click)="goBack()">
        <i class="fas fa-chevron-left"></i> Quay l·∫°i danh s√°ch
      </button>
    </div>

    <div class="product-detail-card bg-white rounded shadow-sm p-4">
      <div class="row g-4">

        <div class="col-md-5">
          <div class="image-gallery border rounded p-3 d-flex align-items-center justify-content-center">
            <img *ngIf="mainImage; else noImage" [src]="mainImage" class="img-fluid main-product-img"
              alt="{{ product.name }}">

            <ng-template #noImage>
              <img src="assets/no-image.png" class="img-fluid opacity-50" alt="No image">
            </ng-template>
          </div>

          <div class="mt-3 text-center text-muted small">
            <small><i>H√¨nh ·∫£nh th·ª±c t·∫ø c·ªßa s·∫£n ph·∫©m</i></small>
          </div>
        </div>

        <div class="col-md-7">

          <h2 class="product-title fw-bold mb-2">{{ product.name }}</h2>

          <div class="d-flex align-items-center gap-3 text-muted small mb-3">
            <span>M√£ SP: <b>#{{ product.id }}</b></span>
            <span>|</span>
            <span>Danh m·ª•c: <b>{{ product.category?.name || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</b></span>
          </div>

          <div class="price-box p-3 rounded mb-4">
            <span class="current-price text-danger fw-bold fs-3">{{ product.price | currency:'VND' }}</span>
            <span class="old-price text-muted text-decoration-line-through ms-3">{{ (product.price * 1.2) |
              currency:'VND' }}</span>
          </div>

          <div class="mb-4">
            <span class="fw-bold">T√¨nh tr·∫°ng: </span>
            <span [class.text-success]="(product.quantity ?? 0) > 0" [class.text-danger]="(product.quantity ?? 0) <= 0"
              class="fw-bold">
              {{ (product.quantity ?? 0) > 0 ? '‚úÖ C√≤n h√†ng' : '‚ùå H·∫øt h√†ng' }}
            </span>
          </div>

          <div *ngIf="product.id !== undefined && (product.quantity ?? 0) > 0"
            class="mb-4 d-flex align-items-center gap-3">
            <label class="fw-bold">S·ªë l∆∞·ª£ng:</label>
            <input type="number" min="1" class="form-control text-center qty-input"
              [(ngModel)]="quantities[product.id]">
          </div>

          <div class="action-buttons d-flex gap-3 mb-4">
            <button class="btn btn-buy-now flex-grow-1" (click)="addToCart(product.id)"
              [disabled]="(product.quantity ?? 0) <= 0">
              <i class="fas fa-cart-plus me-2"></i> TH√äM V√ÄO GI·ªé NGAY
              <small class="d-block fw-normal" style="font-size: 11px;">(Giao t·∫≠n n∆°i ho·∫∑c nh·∫≠n t·∫°i c·ª≠a h√†ng)</small>
            </button>
          </div>

          <div *ngIf="isAdmin" class="admin-actions border-top pt-3">
            <p class="text-muted small mb-2 fw-bold">‚öôÔ∏è Qu·∫£n tr·ªã vi√™n:</p>
            <div class="d-flex gap-2">
              <button class="btn btn-warning btn-sm" (click)="edit()">
                ‚úèÔ∏è S·ª≠a s·∫£n ph·∫©m
              </button>
              <button class="btn btn-danger btn-sm" (click)="delete()">
                üóëÔ∏è X√≥a s·∫£n ph·∫©m
              </button>
            </div>
          </div>

        </div>
      </div>
      <div class="row mt-5">
        <div class="col-12">
          <div class="description-box bg-light p-4 rounded border">
            <h5 class="fw-bold text-danger border-bottom pb-2 mb-3">ƒê·∫∂C ƒêI·ªÇM N·ªîI B·∫¨T</h5>
            <div class="description-content text-justify">
              {{ product.description || 'ƒêang c·∫≠p nh·∫≠t n·ªôi dung m√¥ t·∫£...' }}
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>